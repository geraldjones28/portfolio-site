# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

Portfolio site for Gerald Jones II with a neofetch-inspired terminal aesthetic, served via Nginx in Docker on a Raspberry Pi home-lab. Includes a blog with a browser-based admin panel for managing posts. Accessible at https://portfolio.geraldjonesii.dev

## Architecture

Two Docker containers orchestrated via `docker-compose.yml`:

- **`web` (nginx:alpine)** — Serves static files from `site/` (bind-mounted read-only) on port 8080→80. Reverse-proxies `/api/blog/` to the blog-api container. Config in `nginx/default.conf` includes security headers (CSP, XFO, etc.) and gzip.
- **`blog-api` (Node.js Express)** — CRUD API for blog posts with JWT auth. Only has write access to `site/blog/`. Not exposed to host — only accessible through Nginx. Source in `blog-api/` (server.js, template.js, Dockerfile).

### Static Site (`site/`)

- `index.html` — Main page: neofetch-inspired layout with ASCII art + key-value stats, CRT power-on animation, animated color bar. All CSS is inline.
- `main.js` — Client-side JS: uptime counter, live stats fetcher (polls `/stats.json` every 60s), theme toggle (localStorage), Konami code easter egg (matrix rain canvas)
- `projects.html`, `skills.html` — Separate pages for projects and skills sections, same terminal chrome styling
- `blog/` — Blog listing (`index.html`, auto-generated by API) and individual post files (e.g. `hello-world.html`)
- `admin/index.html` — Blog admin SPA: login, create/edit/delete posts via `/api/blog/` endpoints

### Blog API (`blog-api/`)

- `server.js` — Express server: password login → JWT token, CRUD endpoints at `/api/blog/posts[/:slug]`, write-locks to serialize file operations
- `template.js` — HTML template generator for blog posts and index page. **Critical: the CSS in `POST_CSS` and `INDEX_CSS` constants is duplicated from the site's terminal styling and must stay in sync with the main site's theme variables.**
- Auth requires `.env` with `BLOG_PASSWORD_HASH` (bcrypt) and `JWT_SECRET` (not committed)

### Stats (`stats/stats.sh`)

Cron job (every minute) writes `site/stats.json` with CPU temp, load avg, and RAM from the Pi. Fetched by `main.js`.

## Running Locally

```bash
docker compose up -d --build          # build and start everything (port 8080)
docker compose down                    # stop all containers
docker compose logs blog-api           # view blog API logs
docker compose up -d --build blog-api  # rebuild just the API after code changes
```

Site available at `http://localhost:8080`, admin at `http://localhost:8080/admin/`.

No build step for static files — `site/` is bind-mounted so edits are served immediately. The blog-api container must be rebuilt after changes to `blog-api/`.

## Style Guide

- **Theme variables**: Defined on `:root`/`[data-theme="dark"]` and `[data-theme="light"]`. Use `var(--accent)`, `var(--text)`, `var(--bg)`, etc. — never hardcode colors
- **Font**: `'Courier New', 'Lucida Console', monospace`
- **Neofetch rows**: `<p class="info-row"><span class="info-label">Key: </span><span class="info-value">value</span></p>`
- **Sections**: `.info-section` with `.info-section-title` header
- **Lists**: `<ul class="info-list">` — items auto-prefixed with `- ` via CSS
- **Progress bars**: `.cert-item` with `.progress-bar` > `.progress-fill` (set width via inline style)
- **Terminal chrome**: All pages (blog, admin, skills, projects) share the same header with red/yellow/green dots, title bar, and theme toggle button
- **CSP constraint**: `default-src 'self'; style-src 'self' 'unsafe-inline'; script-src 'self' 'unsafe-inline'` — no external resources allowed

## Key Constraints

- `.env` and `site/stats.json` are gitignored — never commit these
- Blog post theme CSS is duplicated in `blog-api/template.js` — when changing theme variables in `site/index.html`, update `POST_CSS` and `INDEX_CSS` in template.js to match
- Blog slugs must match: lowercase alphanumeric + hyphens, 2-100 chars, can't start/end with hyphen
- Each blog/skills/projects page has its own inline theme toggle script (not shared from main.js)
- Cron job path is hardcoded: `* * * * * /home/raspjones/portfolio-site/stats/stats.sh`
